<style>
    .workspace {
        border-color: #454456 !important;
        border: 1px solid transparent;
        background-color: #fbfbfb;
        margin-top: 2%;
        width: 70%;
        margin-left: 18%;
        border-radius: 5px;
    }

    .textM {
        min-width: 98%;
        margin-top: 1%;
        margin-bottom: 1%;
        margin-left: 1%;
        margin-right: 1%;
    }

    .element {
        margin-top: 1%;
        margin-bottom: 1%;
        text-align: center;
    }

    .instruments {
        margin-bottom: 1%;
        margin-top: 1%;
        text-align: center
    }

    .instrument {
        padding: 20px;
        background-color: black;
    }

    .dragSteps {
       display:inline-block;
    }

</style>


<div [dragula]='"first-bag"' [dragulaModel]='instruction.steps'>
    <div *ngFor="let step of instruction.steps; let j = index">
        <p-panel [toggleable]="true" [style]="{'margin-top':'20px','width':'80%','margin-left':'10%'}">
            <p-header >           
                <label >Step {{j}}: {{step.name}}</label>  
                <a class="btn-xs pull-right ui-panel-titlebar-icon ui-panel-titlebar-toggler ui-corner-all ui-state-default" (click)="deleteStep(j)" >
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </a>
             
            </p-header>
            <div style="margin-left:34%">
                <input [(ngModel)]="step.name" class="form-control" placeholder="Input step name" style="text-align:center" />
            </div>
            <div [dragula]='"second-bag"' [dragulaModel]='step.blocks'>
                <div *ngFor="let item of step.blocks; let i = index">
                    <div ngSwitch="{{item.type}}">
                        <div *ngSwitchCase="'text'">
                            <div class="row textM">
                                <div class="pull-left" style="margin-left:-4%">
                                    <span class="fa fa-hand-rock-o fa-lg"></span>
                                </div>
                                <div class="pull-right" style="margin-right:-4%">
                                    <span title="Delete" (click)="removeElement(j,i)" class="glyphicon glyphicon-trash "></span>
                                </div>

                                <div style="word-wrap:break-word;" [innerHTML]="item.field" *ngIf="!item.state" (click)="turn(j,i)">
                                </div>

                                <p-editor *ngIf="item.state" [(ngModel)]="item.field" [style]="{'height':'200px'}">
                                    <p-header>
                                        <span class="ql-formats">
                                            <select class="ql-header">
                                                <option value="1">Heading</option>
                                                <option value="2">Subheading</option>
                                                <option selected="">Normal</option>
                                            </select>
                                            <button class="ql-bold" aria-label="Bold"></button>
                                            <button class="ql-italic" aria-label="Italic"></button>
                                            <button class="ql-underline" aria-label="Underline"></button>
                                        </span>
                                        <button class="pull-right" pButton type="button" icon="fa-close" (click)="turn(j,i)"></button>
                                    </p-header>
                                </p-editor>

                            </div>
                        </div>

                        <div *ngSwitchCase="'photo'">
                            <div class="element">
                                <div class="pull-left" style="margin-left:-3%">
                                    <span class="fa fa-hand-rock-o fa-lg"></span>
                                </div>
                                <div class="pull-right" style="margin-right:-3%">
                                    <span title="Delete" (click)="removeElement(j,i)" class="glyphicon glyphicon-trash "></span>
                                </div>
                                <cl-image width="450" height="250" [public-id]=item.field [cloud-name]="uploader.cloudName"></cl-image>

                            </div>
                        </div>

                        <div *ngSwitchCase="'video'">
                            <div class="element">
                                <div class="pull-left" style="margin-left:-3%">
                                    <span class="fa fa-hand-rock-o fa-lg"></span>
                                </div>
                                <div class="pull-right" style="margin-right:-3%">
                                    <span title="Delete" (click)="removeElement(j,i)" class="glyphicon glyphicon-trash "></span>
                                </div>
                                <div *ngIf="!item.state">                                

                                    <div class="form-horizontal">
                                        <input type="text" [(ngModel)]="item.field"  class="form-control" placeholder="Youtube URL" style="width:280px;max-width:280px;display:inline-block" />
                                        <button  (click)="addYoutubeUrl(j,i)" type="submit" class="btn btn-default" style="margin-left:-8px;margin-top:-2px; background-color:black;color:aliceblue">
                                           Add
                                        </button>
                                    </div>

                                </div>
                                <iframe *ngIf="item.state" [src]="item.field | safe" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <p-footer>
                <div class="instruments">
                    <label (click)="AddText(j)" title="Add text" class="btn instrument btn-default btn-lg"><span class="glyphicon glyphicon-pencil fa-lg" style="color:aliceblue"></span></label>
                    <label title="Add photo" class="btn instrument btn-default btn-lg">
                        <span class="glyphicon glyphicon-camera " style="color:aliceblue"></span>
                        <input class="hidden" type="file" ng2FileSelect [uploader]="uploader" (change)="onChange($event,j)" />
                    </label>
                    <label (click)="AddVideo(j)" title="Add video" class="btn instrument btn-default btn-lg"><span class="glyphicon glyphicon-facetime-video" style="color:aliceblue"></span></label>
                </div>
            </p-footer>
        </p-panel>
    </div>
</div>

    <button (click)="addStep()" class="btn btn-default" style="background-color:black; color:aliceblue; margin-top:2%; margin-left:47%">Add step</button>

